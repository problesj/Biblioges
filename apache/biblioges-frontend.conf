<VirtualHost *:80>
    ServerName 192.168.72.5
    ServerAdmin webmaster@tu-dominio.com
    
    # Frontend en la raíz
    DocumentRoot /var/www/html/biblioges/view
    
    # Configuración del frontend (raíz)
    <Directory /var/www/html/biblioges/view>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        AddDefaultCharset utf-8
        Require all granted

        AddHandler application/x-httpd-php .php
        DirectoryIndex index.php

        # Configuración de mod_rewrite para el frontend
        RewriteEngine On
        RewriteBase /
        
        # Si la solicitud no es para un archivo existente
        RewriteCond %{REQUEST_FILENAME} !-f
        # Si la solicitud no es para un directorio existente
        RewriteCond %{REQUEST_FILENAME} !-d
        # Redirigir todo a index.php
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>
    
    # Backend en /biblioges/
    Alias /biblioges /var/www/html/biblioges/public
    
    <Directory /var/www/html/biblioges/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        AddDefaultCharset utf-8
        Require all granted

        AddHandler application/x-httpd-php .php
        DirectoryIndex index.php

        # Configuración de mod_rewrite para el backend
        RewriteEngine On
        RewriteBase /biblioges/
        
        # Si la solicitud no es para un archivo existente
        RewriteCond %{REQUEST_FILENAME} !-f
        # Si la solicitud no es para un directorio existente
        RewriteCond %{REQUEST_FILENAME} !-d
        # Redirigir todo a index.php
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>
    
    # Configuración de PHP
    PHPIniDir /etc/php/8.3/apache2
    
    # Configuración de sesiones
    php_value session.save_handler files
    php_value session.save_path "/var/lib/php/sessions"
    php_value session.gc_probability 1
    php_value session.gc_divisor 100
    php_value session.gc_maxlifetime 1440
    
    # Configuración de caché para archivos estáticos
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/ico "access plus 1 month"
    </IfModule>
    
    # Compresión GZIP
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
    
    ErrorLog ${APACHE_LOG_DIR}/biblioges-error.log
    CustomLog ${APACHE_LOG_DIR}/biblioges-access.log combined
</VirtualHost> 