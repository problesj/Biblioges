{% extends "base.twig" %}

{% block title %}
    {% if facultad %}Editar Facultad{% else %}Nueva Facultad{% endif %} - Biblioges
{% endblock %}

{% block stylesheets %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="form-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0 text-gray-800">
                {% if facultad %}Editar Facultad{% else %}Nueva Facultad{% endif %}
            </h1>
            <a href="{{ app_url }}facultades" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>

        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    {% if facultad %}Editar información de la facultad{% else %}Información de la nueva facultad{% endif %}
                </h6>
            </div>
            <div class="card-body">
                <form method="POST" action="{% if facultad %}{{ app_url }}facultades/{{ facultad.id }}/update{% else %}{{ app_url }}facultades/store{% endif %}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="codigo" class="form-label">Código de Facultad <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="codigo" name="codigo" 
                                   value="{{ facultad.codigo ?? '' }}" required maxlength="10">
                            <div class="form-text">Ingrese un código único para la facultad (máximo 10 caracteres)</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="nombre" class="form-label">Nombre de la Facultad <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="nombre" name="nombre" 
                                   value="{{ facultad.nombre ?? '' }}" required maxlength="255">
                            <div class="form-text">Ingrese el nombre completo de la facultad</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="sede_id" class="form-label">Sede <span class="text-danger">*</span></label>
                            <select class="form-control" id="sede_id" name="sede_id" required>
                                <option value="">Seleccione una sede</option>
                                {% for sede in sedes %}
                                <option value="{{ sede.id }}" {% if facultad and facultad.sede_id == sede.id %}selected{% endif %}>
                                    {{ sede.nombre }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Seleccione la sede a la que pertenece la facultad</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-control" id="estado" name="estado">
                                <option value="1" {% if not facultad or facultad.estado == 1 %}selected{% endif %}>Activo</option>
                                <option value="0" {% if facultad and facultad.estado == 0 %}selected{% endif %}>Inactivo</option>
                            </select>
                            <div class="form-text">Seleccione el estado de la facultad</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <hr>
                            <div class="d-flex justify-content-end">
                                <a href="{{ app_url }}facultades" class="btn btn-secondary me-2">
                                    <i class="fas fa-times"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> 
                                    {% if facultad %}Actualizar{% else %}Guardar{% endif %}
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function() {
        // Mostrar mensajes de sesión con SweetAlert2
        {% if session.flash.success %}
            Swal.fire({
                icon: 'success',
                title: '¡Éxito!',
                text: '{{ session.flash.success|raw }}',
                timer: 3000,
                showConfirmButton: false
            });
        {% endif %}

        {% if session.flash.error %}
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: '{{ session.flash.error|raw }}',
                timer: 5000,
                showConfirmButton: false
            });
        {% endif %}

        // Validación del formulario
        $('form').on('submit', function(e) {
            const codigo = $('#codigo').val().trim();
            const nombre = $('#nombre').val().trim();
            const sede_id = $('#sede_id').val();

            if (!codigo) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El código de la facultad es obligatorio'
                });
                $('#codigo').focus();
                return false;
            }

            if (!nombre) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'El nombre de la facultad es obligatorio'
                });
                $('#nombre').focus();
                return false;
            }

            if (!sede_id) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'Campo requerido',
                    text: 'Debe seleccionar una sede'
                });
                $('#sede_id').focus();
                return false;
            }
        });
    });
</script>
{% endblock %} 